<!DOCTYPE html>
<html lang="en">

<head>
	<title></title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- <link rel="icon" href="/favicon.ico" /> -->
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body> [...] <a href="">Test</a>
	<div id="contact">
		<!-- <form action="mailto:marielea.cote@gmail.com" target="_blank" method="POST" enctype="text/plain"> -->
		<form name="formulaire" onsubmit="return validerFormulaire()" method="GET">
			<section>
				<h2>Payment information</h2>
				<p>
					<label for="prenom">Prénom</label><br>
					<input type="text" id="prenom" name="prenom">
				</p>
				<p>
					<label for="nom">Nom de famille</label><br>
					<input type="text" id="nom" name="nom">
				</p>
				<p>
					<label for="telephone">Téléphone</label><br>
					<!-- Pattern accepte les formats suivants: 
						123-456-7890, 1234567890, (123) 456-7890, 123 456 7890, 123.456.7890, +91 (123) 456-7890 -->
					<!-- <input type="text" id="telephone" name="telephone"
						pattern="^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$"> -->
					<input type="text" id="telephone" name="telephone">
				</p>
				<p>
					<label for="courriel">Courriel</label><br>
					<!-- Pattern ajouté pour une meilleure validation -->
					<!-- <input type="email" id="courriel" name="courriel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"> -->
					<input type="email" id="courriel" name="courriel">
				</p>
			</section>

			<section>
				<h2>Shipping Address</h2>
				<p>
					<label for="street1">Street</label>
					<input type="text" id="street1" name="street1">
				</p>
				<p>
					<label for="street2">Street line 2</label>
					<input type="text" id="street2" name="street2">
				</p>
				<p>
					<label for="ville">Ville</label>
					<input type="text" id="ville" name="ville">
				</p>
				<p>
					<label for="province">Province</label><br>
					<!-- Organisé selon les 2 options les plus probables, puis alphabétiquement -->
					<select id="province" name="province">
						<option value="" selected disabled>Sélectionnez
							votre province</option>
						<option value="QC">Québec</option>
						<option value="ON">Ontario</option>
						<option value="AB">Alberta</option>
						<option value="BC">Colombie-Britannique</option>
						<option value="PE">Île-du-Prince-Édouard
						</option>
						<option value="MB">Manitoba</option>
						<option value="NB">Nouveau-Brunswick</option>
						<option value="NS">Nouvelle-Écosse</option>
						<option value="NU">Nunavut</option>
						<option value="SK">Saskatchewan</option>
						<option value="NL">Terre-Neuve-et-Labrador
						</option>
						<option value="NT">Territoires du Nord-Ouest
						</option>
						<option value="YT">Yukon</option>
					</select>
				</p>
				<p>
					<label for="codepostal">Code postal</label>
					<!-- Vérification stricte pour un code postal canadien, acceptant les minuscules -->
					<!-- <input type="text" id="codepostal" name="codepostal" required
						pattern="[ABCEGHJ-NPRSTVXYabceghj-nprstv-z][0-9][ABCEGHJ-NPRSTV-Zabceghj-nprstv-z] [0-9][ABCEGHJ-NPRSTV-Zabceghj-nprstv-z][0-9]"
						title="Veuillez entrer un code postal canadien valide."> -->
					<input type="text" id="codepostal" name="codepostal">
				</p>
			</section>

			<p>
				<label for="instructions">Instructions supplémentaires</label><br>
				<textarea id="instructions" name="instructions"></textarea>
			</p>
			<input type="submit" value="Envoyer">
		</form>
	</div>
	<!-- <script src="/js/script.js"></script> -->
	<script type="text/javascript">

		const setCookie = (cname, cvalue, exdays) => {
			const d = new Date();
			d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
			const expiration = "expires=" + d.toUTCString();
			document.cookie = cname + "=" + cvalue + ";" + expiration + ";path=/;SameSite=None;Secure;";
		}

		const getCookie = (cname) => {
			const name = cname + "=";
			const decodedCookie = decodeURIComponent(document.cookie);
			const cookieArray = decodedCookie.split(";");

			/* ML - See if there's a more efficient way to do this */
			/* ML - When you get the time, describe this to understand it */
			for (let i = 0; i < cookieArray.length; i++) {
				let ck = cookieArray[i];
				while (ck.charAt(0) == " ") {
					ck = ck.substring(1);
				}
				if (ck.indexOf(name) == 0) {
					return ck.substring(name.length, ck.length);
				} else {
					return "";
				}
			}
		}

		/* Another getCookie function - see later
		function getCookie(name)
    {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }		
		 */

		const validerFormulaire = () => {
			const form = document.forms["formulaire"];

			/* Mets les réponses en cookie pour garder les infos après avoir soumis le formulaire */
			const joursCookie = 2;
			setCookie("prenom", form.prenom.value, joursCookie);
			setCookie("nom", form.nom.value, joursCookie);
			setCookie("telephone", form.telephone.value, joursCookie);
			setCookie("courriel", form.courriel.value, joursCookie);
			setCookie("street1", form.street1.value, joursCookie);
			setCookie("street2", form.street2.value, joursCookie);
			setCookie("ville", form.ville.value, joursCookie);
			setCookie("province", form.province.value, joursCookie);
			setCookie("codepostal", form.codepostal.value, joursCookie);
			setCookie("instructions", form.instructions.value, joursCookie);

			prepopuleFormulaire();

			/* Prénom */
			let str = form.prenom.value;
			let regex = RegExp('^([A-Za-zÀ-ÖØ-öø-ÿ_\s\-]*)$');
			if (str.match(regex) || str === "") {
				document.querySelector("#prenom").classList.remove("invalide");
			} else {
				document.querySelector("#prenom").classList.add("invalide");
			}
			/* Nom */
			str = form.nom.value;
			if (str.match(regex) || str === "") {
				document.querySelector("#nom").classList.remove("invalide");
			} else {
				document.querySelector("#nom").classList.add("invalide");
			}
			
			/* Rue */
			str = form.street1.value;
			if (str.match(regex) || str === "") {
				document.querySelector("#street1").classList.remove("invalide");
			} else {
				document.querySelector("#street1").classList.add("invalide");
			}
			str = form.street2.value;
			if (str.match(regex) || str === "") {
				document.querySelector("#street2").classList.remove("invalide");
			} else {
				document.querySelector("#street2").classList.add("invalide");
			}
			/* Rue */
			str = form.ville.value;
			if (str.match(regex) || str === "") {
				document.querySelector("#ville").classList.remove("invalide");
			} else {
				document.querySelector("#ville").classList.add("invalide");
			}
			/* Instructions */
			str = form.instructions.value;
			if (str.match(regex) || str === "") {
				document.querySelector("#instructions").classList.remove("invalide");
			} else {
				document.querySelector("#instructions").classList.add("invalide");
			}

			/* Téléphone */
			str = form.telephone.value;
			regex = RegExp('^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$');
			if (str.match(regex) || str === "") {
				document.querySelector("#telephone").classList.remove("invalide");
			} else {
				document.querySelector("#telephone").classList.add("invalide");
			}
			/* Courriel */
			str = form.courriel.value;
			regex = RegExp('[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$');
			if (str.match(regex) || str === "") {
				document.querySelector("#courriel").classList.remove("invalide");
			} else {
				document.querySelector("#courriel").classList.add("invalide");
			}

			/* Code postal */
			str = form.codepostal.value;
			regex = RegExp('[ABCEGHJ-NPRSTVXYabceghj-nprstv-z][0-9][ABCEGHJ-NPRSTV-Zabceghj-nprstv-z] [0-9][ABCEGHJ-NPRSTV-Zabceghj-nprstv-z][0-9]');
			if (str.match(regex) || str === "") {
				document.querySelector("#codepostal").classList.remove("invalide");
			} else {
				document.querySelector("#codepostal").classList.add("invalide");
			}
			debugger;
			// validerChamp(str, regex, inputId);

			

		}

		/* Doesn't seem to work - 405 not allowed */
		// const validerChamp = (str = "", regex, inputId) => {
		// 	if (str.match(regex) || str === "") {
		// 		document.querySelector(inputId).classList.remove("invalide");
		// 	} else {
		// 		document.querySelector(inputId).classList.add("invalide");
		// 	}
		// }

		/* Remets les valeurs dans le formulaire */
		/* Enlevé le domain, check if it works again */
		/* the undefined thing doesn't work as is, resreach more typeof */
		const prepopuleFormulaire = () => {
			let formArray = ["prenom", "nom", "telephone", "courriel", "street1", "street2", "ville", "codepostal", "instructions"]

			formArray.forEach(champ => document.querySelector(`#${champ}`).value = getCookie(champ));

			// let str = getCookie("prenom");
			// document.querySelector("#prenom").value = getCookie("prenom");

			// str = getCookie("nom");
			// document.querySelector("#nom").value = getCookie("nom");

			// str = getCookie("telephone");
			// document.querySelector("#telephone").value = getCookie("telephone");

			// str = getCookie("courriel");
			// document.querySelector("#courriel").value = getCookie("courriel");

			// str = getCookie("street1");
			// document.querySelector("#street1").value = getCookie("street1");

			// str = getCookie("street2");
			// document.querySelector("#street2").value = getCookie("street2");

			// str = getCookie("ville");
			// document.querySelector("#ville").value = getCookie("ville");

			// str = getCookie("codepostal");
			// document.querySelector("#codepostal").value = getCookie("codepostal");

			// str = getCookie("instructions");
			// document.querySelector("#instructions").value = getCookie("instructions");


			/* Rajouter la condition d'attribut selected pour province */


		}

		prepopuleFormulaire();



	</script>
</body>

</html>